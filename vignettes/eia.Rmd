---
title: "Package overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Package overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



This vignette provides a brief overview of the most important functions in `eia`. Other vignettes go into greater depth on specific topics and API endpoints.

## API key

### Register a key with EIA

Obtaining an API key is easy and free.

Pulling data from the US Energy Information Administration (EIA) API requires a registered API key. A key can be obtained at no cost [here](https://www.eia.gov/opendata/register.php). A valid email and agreement to the API Terms of Service is required to obtain a key.

It is important to store your API key somewhere secure. Do not commit it to a repository or otherwise share it. For example, you could store it in your `.Renviron` file.

### Key storage and retrieval

You can always provide the `key` argument to every API function call, but you do not have to. There are getter and setter helpers available to make using `eia` functions a more seamless experience.

`eia_set_key()` gives you the option of storing your key for the duration of your R session.



```r
library(eia)
# eia_set_key("yourkey")
# eia_get_key() # retrieve it
```

If the key already exists in the system environment and you plan to pass `key`
to functions explicitly, you could start as follows.


```r
key <- Sys.getenv("EIA_KEY")
# or:
key <- eia_get_key()
```

In general, however, if your key is set globally such as in `.Renviron`, you do
not need to do anything regarding the key when you use the package.
See the vignette on API details for more information about all the options you have for key storage.

## EIA directories

Once you have your EIA registered API key and have it in place for your R session
by whichever method you prefer, you are ready to begin accessing data from the EIA API.

The EIA's APIv2 has been redesigned to be more human friendly, and rather than
rely on the numeric ID values, is now built around a self-searchable folder
structure where the ID values are now just natural language, i.e. words.

Here is the top-level directory information:


```r
eia_dir()
#> # A tibble: 14 × 3
#>    id                name                            description                                                                                       
#>    <chr>             <chr>                           <chr>                                                                                             
#>  1 coal              Coal                            EIA coal energy data                                                                              
#>  2 crude-oil-imports Crude Oil Imports               Crude oil imports by country to destination, includes type, grade, quantity.  Source: EIA-814  In…
#>  3 electricity       Electricity                     EIA electricity survey data                                                                       
#>  4 international     International                   Country level production, consumption, imports, exports by energy source (petroleum, natural gas,…
#>  5 natural-gas       Natural Gas                     EIA natural gas survey data                                                                       
#>  6 nuclear-outages   Nuclear Outages                 EIA nuclear outages survey data                                                                   
#>  7 petroleum         Petroleum                       EIA petroleum gas survey data                                                                     
#>  8 seds              State Energy Data System (SEDS) Estimated production, consumption, price, and expenditure data for all energy sources by state an…
#>  9 steo              Short Term Energy Outlook       Monthly short term (18 month) projections using STEO model.  Report and interactive projection da…
#> 10 densified-biomass Densified Biomass               EIA densified biomass data                                                                        
#> 11 total-energy      Total Energy                    These data represent the most recent comprehensive energy statistics integrated across all energy…
#> 12 aeo               Annual Energy Outlook           Annual U.S. projections using National Energy Modelling System (NEMS) for release year.  Report, …
#> 13 ieo               International Energy Outlook    Annual international projections using the World Energy Projection System (WEPS) model for releas…
#> 14 co2-emissions     State CO2 Emissions             EIA CO2 Emissions data
```

You can navigate deeper into this directory by supplying a folder id (e.g. id = "electricity").


```r
eia_dir("electricity")
#> # A tibble: 6 × 3
#>   id                              name                                                                       description                               
#>   <chr>                           <chr>                                                                      <chr>                                     
#> 1 retail-sales                    Electricity Sales to Ultimate Customers                                    "Electricity sales to ultimate customer b…
#> 2 electric-power-operational-data Electric Power Operations (Annual and Monthly)                             "Monthly and annual electric power operat…
#> 3 rto                             Electric Power Operations (Daily and Hourly)                               "Hourly and daily electric power operatio…
#> 4 state-electricity-profiles      State Specific Data                                                        "State Specific Data"                     
#> 5 operating-generator-capacity    Inventory of Operable Generators                                           "Inventory of operable generators in the …
#> 6 facility-fuel                   Electric Power Operations for Individual Power Plants (Annual and Monthly) "Annual and monthly electric power operat…
```

And, because this APIv2 is a directory listing, to go any deeper simply requires
appending the next id separated by `"/"`, where the first folder ID in from the top-level
directory is "electricity" and the next folder ID in from there is "retail-sales", we
would supply "electricity/retail-sales" to the first argument in `eia_dir()`, as
shown below.


```r
eia_dir("electricity/retail-sales")
```

Now we've reached the end of the directory path, as you can see by the message
provided in the console output; i.e. there are no more sub-folders to explore;
and as such, you are prompted to explore the available data at the end
of this directory path with `eia_metadata()`.


## EIA metadata

`eia_metadata()` provides as the name suggests - metadata on a given set of data
provided by a terminal directory path, which includes:

* Name
* Description
* Data values (i.e. column names)
* Facets (i.e. filter options)
  * e.g. filter on State = "OH" and Sector = "RES" (residential)
* Frequencies (i.e. available time denominations)
  * e.g. monthly, quarterly, annual, etc.
* Defaults
  * e.g. default date format and frequency
* Date range


```r
eia_metadata("electricity/retail-sales")
#> $Name
#> [1] "Electricity Sales to Ultimate Customers"
#> 
#> $Description
#> [1] "Electricity sales to ultimate customer by state and sector (number of customers, average price, revenue, and megawatthours of sales).  \n    Sources: Forms EIA-826, EIA-861, EIA-861M"
#> 
#> $Data
#> # A tibble: 4 × 3
#>   id        alias                                              units                 
#>   <chr>     <chr>                                              <chr>                 
#> 1 revenue   Revenue from Sales to Ultimate Customers           million dollars       
#> 2 sales     Megawatthours Sold to Utlimate Customers           million kilowatthours 
#> 3 price     Average Price of Electricity to Utlimate Customers cents per kilowatthour
#> 4 customers Number of Ultimate Customers                       number of customers   
#> 
#> $Facets
#> # A tibble: 2 × 2
#>   id       description          
#>   <chr>    <chr>                
#> 1 stateid  State / Census Region
#> 2 sectorid Sector               
#> 
#> $Frequency
#> # A tibble: 3 × 4
#>   id        description                            query format 
#>   <chr>     <chr>                                  <chr> <chr>  
#> 1 monthly   One data point for each month.         M     YYYY-MM
#> 2 quarterly One data point every 3 months.         Q     YYYY-QQ
#> 3 annual    One data point for each calendar year. A     YYYY   
#> 
#> $Defaults
#> # A tibble: 1 × 2
#>   format  frequency
#>   <chr>   <chr>    
#> 1 YYYY-MM monthly  
#> 
#> $Period
#> # A tibble: 1 × 2
#>   start   end    
#>   <chr>   <chr>  
#> 1 2001-01 2023-08
```

## EIA data

### Data structure

Once you have the necessary metadata from above, you will have a better understanding
of what data is available and can query the API for that data using `eia_data()`.
However, simply supplying the above directory path from above ("electricity/retail-sales")
will only provide the data structure with no meaningful values.


```r
eia_data("electricity/retail-sales") |> head()
#> # A tibble: 6 × 5
#>   period  stateid stateDescription   sectorid sectorName    
#>   <chr>   <chr>   <chr>              <chr>    <chr>         
#> 1 2008-07 WSC     West South Central IND      industrial    
#> 2 2008-07 WSC     West South Central OTH      other         
#> 3 2008-07 WSC     West South Central RES      residential   
#> 4 2008-07 WSC     West South Central TRA      transportation
#> 5 2008-07 MTN     Mountain           ALL      all sectors   
#> 6 2008-07 MTN     Mountain           COM      commercial
```

Note the console warning that appears. The API can only provide a maximum of 5000
records. If there are more data available than returned, a warning message like above
will be provided informing the user of their "incomplete return".

### Data values

To get data values, e.g. prices, you must supply the proper column name id, as provided
in the Data Values section of the `eia_metadata()` console output, in this case `"price"`.


```r
eia_data("electricity/retail-sales", data = "price", length = 6)
#> # A tibble: 6 × 7
#>   period  stateid stateDescription   sectorid sectorName     price `price-units`         
#>   <chr>   <chr>   <chr>              <chr>    <chr>          <dbl> <chr>                 
#> 1 2008-07 WSC     West South Central IND      industrial      9.33 cents per kilowatthour
#> 2 2008-07 WSC     West South Central OTH      other          NA    cents per kilowatthour
#> 3 2008-07 WSC     West South Central RES      residential    12.9  cents per kilowatthour
#> 4 2008-07 WSC     West South Central TRA      transportation  8.64 cents per kilowatthour
#> 5 2008-07 MTN     Mountain           ALL      all sectors     9.02 cents per kilowatthour
#> 6 2008-07 MTN     Mountain           COM      commercial      8.96 cents per kilowatthour
```

Now we have pricing data values column-bound to the data structure.

## EIA facets

### Getting facet values

But what if we only want data for one sector, say "residential"?
This is where facets arrive, and for any given terminal directory, the facet values
can be found with `eia_facets()` by supplying the terminal directory path and facet id,
the latter of which can be found from the console output of `eia_metadata()`.


```r
eia_facets("electricity/retail-sales", "sectorid")
#> # A tibble: 6 × 3
#>   id    name           alias               
#>   <chr> <chr>          <chr>               
#> 1 RES   residential    (RES) residential   
#> 2 COM   commercial     (COM) commercial    
#> 3 ALL   all sectors    (ALL) all sectors   
#> 4 OTH   other          (OTH) other         
#> 5 TRA   transportation (TRA) transportation
#> 6 IND   industrial     (IND) industrial
# or
eia_facets("electricity/retail-sales", "stateid")
#> # A tibble: 62 × 3
#>    id    name               alias                           
#>    <chr> <chr>              <chr>                           
#>  1 MA    Massachusetts      (MA) Massachusetts              
#>  2 VT    Vermont            (VT) Vermont                    
#>  3 WA    Washington         (WA) Washington                 
#>  4 HI    Hawaii             (HI) Hawaii                     
#>  5 WNC   West North Central Region: (WNC) West North Central
#>  6 NC    North Carolina     (NC) North Carolina             
#>  7 ENC   East North Central Region: (ENC) East North Central
#>  8 MTN   Mountain           Region: (MTN) Mountain          
#>  9 MD    Maryland           (MD) Maryland                   
#> 10 VA    Virginia           (VA) Virginia                   
#> # ℹ 52 more rows
```

### Using facet values

Now we can use any of the ID values from the above output to further limit our
returned data with the `facets` argument in `eia_data()`.


```r
eia_data(
  dir = "electricity/retail-sales",
  data = "price",
  facets = list(sectorid = "RES", stateid = "OH"),
  length = 6
)
#> # A tibble: 6 × 7
#>   period  stateid stateDescription sectorid sectorName  price `price-units`         
#>   <chr>   <chr>   <chr>            <chr>    <chr>       <dbl> <chr>                 
#> 1 2008-08 OH      Ohio             RES      residential  10.8 cents per kilowatthour
#> 2 2010-11 OH      Ohio             RES      residential  11.5 cents per kilowatthour
#> 3 2022-05 OH      Ohio             RES      residential  13.5 cents per kilowatthour
#> 4 2016-05 OH      Ohio             RES      residential  13.2 cents per kilowatthour
#> 5 2015-06 OH      Ohio             RES      residential  13.2 cents per kilowatthour
#> 6 2019-03 OH      Ohio             RES      residential  12.3 cents per kilowatthour
```

Further information on obtaining data - subsets and sorting of - can be found in the data vignette.
