---
title: "Package overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Package overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



This vignette provides a brief overview of the most important functions in `eia`. Other vignettes go into greater depth on specific topics and API endpoints.

## API key

### Register a key with EIA

Obtaining an API key is easy and free.

Pulling data from the US Energy Information Administration (EIA) API requires a registered API key. A key can be obtained at no cost [here](https://www.eia.gov/opendata/register.php). A valid email and agreement to the API Terms of Service is required to obtain a key.

It is important to store your API key somewhere secure. Do not commit it to a repository or otherwise share it. For example, you could store it in your `.Renviron` file.

### Key storage and retrieval

You can always provide the `key` argument to every API function call, but you do not have to. There are getter and setter helpers available to make using `eia` functions a more seamless experience.

`eia_set_key` gives you the option of storing your key for the duration of your R session.



```r
library(eia)
# eia_set_key("yourkey")
# eia_get_key() # retrieve it
```

If the key already exists in the system environment and you plan to pass `key`
to functions explicitly, you could start as follows.


```r
key <- Sys.getenv("EIA_KEY")
# or:
key <- eia_get_key()
```

In general, however, if your key is set globally such as in `.Renviron`, you do
not need to do anything regarding the key when you use the package.
See the vignette on API details for more information about all the options you have for key storage.

## EIA directories

Once you have your EIA registered API key and have it in place for your R session
by whichever method you prefer, you are ready to begin accessing data from the EIA API.

The EIA's APIv2 has been redesigned to be more human friendly, and rather than
rely on the numeric ID values, is now built around a self-discoverable folder
structure where the ID values are now just natural language, i.e. words.

Here is the top-level directory information:


```r
eia_directory()
#> # A tibble: 14 × 3
#>    id                name                            description                                                                             
#>    <chr>             <chr>                           <chr>                                                                                   
#>  1 coal              Coal                            EIA coal energy data                                                                    
#>  2 crude-oil-imports Crude Oil Imports               Crude oil imports by country to destination, includes type, grade, quantity.  Source: E…
#>  3 electricity       Electricity                     EIA electricity survey data                                                             
#>  4 international     International                   Country level production, consumption, imports, exports by energy source (petroleum, na…
#>  5 natural-gas       Natural Gas                     EIA natural gas survey data                                                             
#>  6 nuclear-outages   Nuclear Outages                 EIA nuclear outages survey data                                                         
#>  7 petroleum         Petroleum                       EIA petroleum gas survey data                                                           
#>  8 seds              State Energy Data System (SEDS) Estimated production, consumption, price, and expenditure data for all energy sources b…
#>  9 steo              Short Term Energy Outlook       Monthly short term (18 month) projections using STEO model.  Report and interactive pro…
#> 10 densified-biomass Densified Biomass               EIA densified biomass data                                                              
#> 11 total-energy      Total Energy                    These data represent the most recent comprehensive energy statistics integrated across …
#> 12 aeo               Annual Energy Outlook           Annual U.S. projections using National Energy Modelling System (NEMS) for release year.…
#> 13 ieo               International Energy Outlook    Annual international projections using the World Energy Projection System (WEPS) model …
#> 14 co2-emissions     State CO2 Emissions             EIA CO2 Emissions data
```

You can navigate deeper into this directory by supplying a folder id (e.g. id = "electricity").


```r
eia_directory("electricity")
#> # A tibble: 6 × 3
#>   id                              name                                                                       description                     
#>   <chr>                           <chr>                                                                      <chr>                           
#> 1 retail-sales                    Electricity Sales to Ultimate Customers                                    "Electricity sales to ultimate …
#> 2 electric-power-operational-data Electric Power Operations (Annual and Monthly)                             "Monthly and annual electric po…
#> 3 rto                             Electric Power Operations (Daily and Hourly)                               "Hourly and daily electric powe…
#> 4 state-electricity-profiles      State Specific Data                                                        "State Specific Data"           
#> 5 operating-generator-capacity    Inventory of Operable Generators                                           "Inventory of operable generato…
#> 6 facility-fuel                   Electric Power Operations for Individual Power Plants (Annual and Monthly) "Annual and monthly electric po…
```

And, because this APIv2 is a directory listing, to go any deeper simply requires
appending the next id separated by `"/"`, where the first folder ID in from the top-level
directory is "electricity" and the next folder ID in from there is "retail-sales", we
would supply "electricity/retail-sales" to the first argument in `eia_directory`, as
shown below.


```r
eia_directory("electricity/retail-sales")
```

Now we've reached the end of the directory path, as you can see by the message
provided in the console output; i.e. there are no more subfolders to explore;
and as such, you are prompted to explore the available data at the end
of this directory path with `eia_metadata`.


## EIA metadata

`eia_metadata` provides as the name suggests - metadata on a given set of data
provided by a terminal directory path, which includes:

  * Name
  * Description
  * Data values (i.e. column names)
  * Facets (i.e. filter options)
    * e.g. filter on State = "OH" and Sector = "RES" (residential)
  * Frequencies (i.e. available time denominations)
    * e.g. monthly, quarterly, annual, etc.
  * Defaults
    * e.g. default date format and frequency
  * Date range


```r
eia_metadata("electricity/retail-sales")
```

## EIA data

### Data structure

Once you have the necessary metadata from above, you will have a better understanding
of what data is available and can query the API for that data using `eia_data`.
However, simply supplying the above directory path from above ("electricity/retail-sales")
will only provide the data structure with no meaningful values.


```r
eia_data("electricity/retail-sales") |> head()
#> # A tibble: 6 × 5
#>   period  stateid stateDescription sectorid sectorName    
#>   <chr>   <chr>   <chr>            <chr>    <chr>         
#> 1 2019-07 ME      Maine            ALL      all sectors   
#> 2 2019-07 ME      Maine            COM      commercial    
#> 3 2019-07 ME      Maine            IND      industrial    
#> 4 2019-07 ME      Maine            OTH      other         
#> 5 2019-07 ME      Maine            RES      residential   
#> 6 2019-07 ME      Maine            TRA      transportation
```

Note the console warning that appears. The API can only provide a maximum of 5000
records. If there are more data available than returned, a warning message like above
will be provided informing the user of their "incomplete return".

### Data values

To get data values, e.g. prices, you must supply the proper column name id, as provided
in the Data Values section of the `eia_metadata` console output, in this case `"price"`.


```r
eia_data("electricity/retail-sales", data = "price", length = 6)
#> # A tibble: 6 × 7
#>   period  stateid stateDescription sectorid sectorName     price `price-units`         
#>   <chr>   <chr>   <chr>            <chr>    <chr>          <dbl> <chr>                 
#> 1 2019-07 ME      Maine            ALL      all sectors    13.6  cents per kilowatthour
#> 2 2019-07 ME      Maine            COM      commercial     12.6  cents per kilowatthour
#> 3 2019-07 ME      Maine            IND      industrial      8.94 cents per kilowatthour
#> 4 2019-07 ME      Maine            OTH      other          NA    cents per kilowatthour
#> 5 2019-07 ME      Maine            RES      residential    17.9  cents per kilowatthour
#> 6 2019-07 ME      Maine            TRA      transportation  0    cents per kilowatthour
```

Now we have pricing data values column-binded to the data structure.

## EIA facets

### Getting facet values

But what if we only want data for one sector, say "residential"?
This is where facets arrive, and for any given terminal directory, the facet values
can be found with `eia_facets()` by supplying the terminal directory path and facet id,
the latter of which can be found from the console output of `eia_metadata`.


```r
eia_facets("electricity/retail-sales", "sectorid")
#> # A tibble: 6 × 3
#>   id    name           alias               
#>   <chr> <chr>          <chr>               
#> 1 COM   commercial     (COM) commercial    
#> 2 RES   residential    (RES) residential   
#> 3 ALL   all sectors    (ALL) all sectors   
#> 4 OTH   other          (OTH) other         
#> 5 TRA   transportation (TRA) transportation
#> 6 IND   industrial     (IND) industrial
# or
eia_facets("electricity/retail-sales", "stateid")
#> # A tibble: 62 × 3
#>    id    name               alias                           
#>    <chr> <chr>              <chr>                           
#>  1 MA    Massachusetts      (MA) Massachusetts              
#>  2 VT    Vermont            (VT) Vermont                    
#>  3 WA    Washington         (WA) Washington                 
#>  4 ENC   East North Central Region: (ENC) East North Central
#>  5 WNC   West North Central Region: (WNC) West North Central
#>  6 NC    North Carolina     (NC) North Carolina             
#>  7 HI    Hawaii             (HI) Hawaii                     
#>  8 MD    Maryland           (MD) Maryland                   
#>  9 NM    New Mexico         (NM) New Mexico                 
#> 10 MTN   Mountain           Region: (MTN) Mountain          
#> # … with 52 more rows
```

### Using facet values

Now we can use any of the ID values from the above output to further limit our
returned data with the `facets` argument in `eia_data`.


```r
eia_data(
  dir = "electricity/retail-sales",
  data = "price",
  facets = list(sectorid = "RES", stateid = "OH"),
  length = 6
)
#> # A tibble: 6 × 7
#>   period  stateid stateDescription sectorid sectorName  price `price-units`         
#>   <chr>   <chr>   <chr>            <chr>    <chr>       <dbl> <chr>                 
#> 1 2016-05 OH      Ohio             RES      residential  13.2 cents per kilowatthour
#> 2 2013-11 OH      Ohio             RES      residential  12.0 cents per kilowatthour
#> 3 2023-03 OH      Ohio             RES      residential  14.9 cents per kilowatthour
#> 4 2013-12 OH      Ohio             RES      residential  11.3 cents per kilowatthour
#> 5 2017-03 OH      Ohio             RES      residential  12.6 cents per kilowatthour
#> 6 2016-11 OH      Ohio             RES      residential  12.4 cents per kilowatthour
```

Further info on obtaining data - subsets & sorting of - can be found in the data vignette.
